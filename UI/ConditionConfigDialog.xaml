<Window x:Class="MacroEngine.UI.ConditionConfigDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        Title="Configurer la condition"
        Height="500" Width="600"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        ResizeMode="CanResizeWithGrip"
        Background="{StaticResource BackgroundPrimaryBrush}"
        PreviewKeyDown="Window_PreviewKeyDown">
    <Window.Resources>
        <!-- Style boutons du contenu (Ajouter une condition, Ajouter, Rafraîchir, etc.) -->
        <Style x:Key="DialogContentButton" TargetType="Button">
            <Setter Property="ClickMode" Value="Press"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="Background" Value="{StaticResource BackgroundTertiaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{StaticResource RadiusButton}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundPrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- Style petit bouton (supprimer ×) -->
        <Style x:Key="DialogSmallButton" TargetType="Button" BasedOn="{StaticResource DialogContentButton}">
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="MinWidth" Value="28"/>
            <Setter Property="MinHeight" Value="26"/>
        </Style>
        <!-- Style pour le tableau "Processus ouvert" (en-têtes de colonnes, version compacte) -->
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="MinHeight" Value="22"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>
        <Style x:Key="ProcessRunningListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="MinHeight" Value="22"/>
            <Setter Property="Padding" Value="2,1"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="RowBorder"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Stretch"
                                Margin="0">
                            <GridViewRowPresenter Content="{TemplateBinding Content}"
                                                   HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                   VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="#15FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="RowBorder" Property="Background" Value="#15FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ProcessRunningListViewStyle" TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource BackgroundPrimaryBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <!-- Bouton supprimer des chips : croix rouge pourpre au hover -->
        <Style x:Key="ChipRemoveButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Width" Value="18"/>
            <Setter Property="Height" Value="18"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="Transparent" CornerRadius="3" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock x:Name="iconTb" Text="&#xE1B2;" FontFamily="{StaticResource FontLucide}" FontSize="10"
                                       Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="iconTb" Property="Foreground" Value="#C25B6B"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Border x:Name="RootBorder"
            Background="{StaticResource BackgroundPrimaryBrush}"
            BorderBrush="{StaticResource BorderLightBrush}"
            BorderThickness="1"
            Focusable="True"
            KeyboardNavigation.IsTabStop="False">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Barre de titre personnalisée (réduire / redimensionner / fermer) -->
            <Border x:Name="TitleBarBorder"
                    Grid.Row="0"
                    shell:WindowChrome.IsHitTestVisibleInChrome="True"
                    Background="{StaticResource BackgroundSecondaryBrush}"
                    BorderBrush="{StaticResource BorderLightBrush}"
                    BorderThickness="0,0,0,1"
                    Padding="16,0,0,0"
                    Height="44"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <!-- Titre -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <TextBlock Text="Configuration de la condition"
                                   Style="{StaticResource TextHeading}"
                                   Foreground="White"
                                   FontSize="15"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    <!-- Boutons Réduire / Agrandir / Fermer -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Stretch"
                                shell:WindowChrome.IsHitTestVisibleInChrome="True">
                        <Button x:Name="MinimizeButton"
                                Style="{StaticResource WindowCaptionButtonStyle}"
                                ClickMode="Press"
                                Focusable="False"
                                Foreground="White"
                                FontFamily="{StaticResource FontLucide}"
                                Content="&#xE11C;"
                                ToolTip="Réduire"
                                Click="MinimizeButton_Click"/>
                        <Button x:Name="MaximizeButton"
                                Style="{StaticResource WindowCaptionButtonStyle}"
                                ClickMode="Press"
                                Focusable="False"
                                Foreground="White"
                                FontFamily="{StaticResource FontLucide}"
                                Content="&#xE167;"
                                ToolTip="Agrandir"
                                Click="MaximizeButton_Click"/>
                        <Button x:Name="CloseButton"
                                Style="{StaticResource WindowCaptionCloseButtonStyle}"
                                ClickMode="Press"
                                Focusable="False"
                                Foreground="White"
                                FontFamily="{StaticResource FontLucide}"
                                Content="&#xE1B2;"
                                ToolTip="Fermer"
                                Click="CloseButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Contenu -->
            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Padding="20,16"
                          Background="{StaticResource BackgroundPrimaryBrush}">
                <Border Background="{StaticResource BackgroundTertiaryBrush}"
                        BorderBrush="{StaticResource BorderInternalBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource RadiusPanel}"
                        Padding="16,12">
                    <StackPanel x:Name="ConfigContentPanel"
                               Orientation="Vertical">
                        <StackPanel.Resources>
                            <Style TargetType="StackPanel">
                                <Setter Property="Margin" Value="0,0,0,12"/>
                            </Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                            <Style TargetType="Label">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="{StaticResource BackgroundTertiaryBrush}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Padding" Value="6,4"/>
                                <Setter Property="CaretBrush" Value="White"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                            <!-- ComboBox : style complet avec liste déroulante sombre -->
                            <Style TargetType="ComboBox">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="{StaticResource BackgroundTertiaryBrush}"/>
                                <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Padding" Value="8,4"/>
                                <Setter Property="MinHeight" Value="28"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ComboBox">
                                            <Grid>
                                                <ToggleButton x:Name="ToggleButton" Focusable="False" IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                              Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                                                              Padding="8,4">
                                                    <ToggleButton.Template>
                                                        <ControlTemplate TargetType="ToggleButton">
                                                            <Border x:Name="border" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="{StaticResource RadiusTextInput}">
                                                                <Path x:Name="Arrow" Fill="White" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,8,0" Data="M 0 0 L 4 4 L 8 0 Z"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </ToggleButton.Template>
                                                </ToggleButton>
                                                <ContentPresenter x:Name="ContentSite" Content="{TemplateBinding SelectionBoxItem}" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                  Margin="8,4,28,4" VerticalAlignment="Center" HorizontalAlignment="Left" IsHitTestVisible="False"/>
                                                <Popup x:Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                                    <Border x:Name="DropDownBorder" Background="{StaticResource BackgroundTertiaryBrush}" BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1" CornerRadius="{StaticResource RadiusTextInput}"
                                                            MinWidth="{TemplateBinding ActualWidth}" MaxHeight="300">
                                                        <ScrollViewer Margin="4,2" SnapsToDevicePixels="True">
                                                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                        </ScrollViewer>
                                                    </Border>
                                                </Popup>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                            <Style TargetType="ComboBoxItem">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Padding" Value="8,6"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ComboBoxItem">
                                            <Border x:Name="border" Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsHighlighted" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                                </Trigger>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="{StaticResource AccentSelectionBrush}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                            <Style TargetType="CheckBox">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="Margin" Value="0,0,8,0"/>
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                            </Style>
                            <!-- Tous les boutons du contenu (Ajouter une condition, Ajouter, Rafraîchir, etc.) -->
                            <Style TargetType="Button" BasedOn="{StaticResource DialogContentButton}"/>
                            <!-- Bordures des panneaux (condition, puces d'apps) -->
                            <Style TargetType="Border">
                                <Setter Property="BorderBrush" Value="{StaticResource BorderLightBrush}"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="CornerRadius" Value="4"/>
                                <Setter Property="Padding" Value="8,6"/>
                            </Style>
                        </StackPanel.Resources>
                    </StackPanel>
                </Border>
            </ScrollViewer>

            <!-- Pied : séparateur + boutons -->
            <Border Grid.Row="2"
                    Background="{StaticResource BackgroundSecondaryBrush}"
                    BorderBrush="{StaticResource BorderLightBrush}"
                    BorderThickness="0,1,0,0"
                    Padding="20,14">
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button x:Name="CancelButton"
                            Content="Annuler"
                            Style="{StaticResource ButtonSecondary}"
                            ClickMode="Press"
                            Focusable="False"
                            Width="90"
                            Height="34"
                            Click="CancelButton_Click"
                            IsCancel="True"
                            Margin="0,0,10,0"/>
                    <Button x:Name="OkButton"
                            Content="OK"
                            Style="{StaticResource ButtonPrimary}"
                            ClickMode="Press"
                            Focusable="False"
                            Width="90"
                            Height="34"
                            Click="OkButton_Click"
                            IsDefault="True"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>
